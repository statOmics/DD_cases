"0","# Subset the data per cell type"
"0","# Filter each cell type separately with edgeR::filterByExpr"
"0","design <- model.matrix(~ Site + sex + Status_on_day_collection_summary, "
"0","                       colData(pb))"
"0","colnames(design) <- sub(""Status_on_day_collection_summary"", """", colnames(design))"
"0","colnames(design)[1] <- ""Intercept"""
"0","label <- pb$cell_type_curated"
"0","pb_ct <- vector(mode =  ""list"", length = length(unique(label)))"
"0",""
"0","for (i in 1:length(unique(label))) {"
"0","  "
"0","  chosen <- label==sort(unique(label))[i]"
"0","  pb_i <- pb[,chosen,drop=FALSE]"
"0","  design_i <-  design[chosen,]"
"0",""
"0","  gkeep <- filterByExpr(pb_i, design=design_i)"
"0","  pb_ct[[i]] <- pb_i[gkeep,]"
"0","}"
"0","names(pb_ct) <- sort(unique(label))"
"0",""
"0","saveRDS(pb_ct, ""./objects/pb_ct_filt.rds"")"
